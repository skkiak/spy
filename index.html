<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–®–ø–∏–æ–Ω Minimal</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-overlay: rgba(10, 10, 10, 0.85);
            --card-bg: rgba(40, 40, 40, 0.4);
            --card-border: rgba(255, 255, 255, 0.08);
            --text-main: #f0f0f0;
            --text-muted: #888888;
            --accent: #ffffff;
            --danger: #ff5252;
            --shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

        body {
            margin: 0;
            font-family: 'Manrope', sans-serif;
            color: var(--text-main);
            background-color: #000;
            /* –§–û–¢–û–ì–†–ê–§–ò–Ø –§–û–ù–ê */
            background-image: url('IMG_0165.jpeg'); 
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
        }

        .app-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-overlay);
            backdrop-filter: blur(8px);
            z-index: -1;
        }

        .screen {
            width: 100%;
            max-width: 420px;
            padding: 24px;
            display: none;
            flex-direction: column;
            height: 100vh;
            justify-content: space-between;
            animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .active-screen { display: flex; }

        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }

        h1 { font-size: 32px; font-weight: 800; margin: 0; letter-spacing: -1px; }
        h2 { font-size: 20px; font-weight: 600; margin: 0; color: var(--text-muted); }
        .hint { color: var(--text-muted); font-size: 13px; margin-top: 5px; }

        .glass-card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--card-border);
            border-radius: 24px;
            padding: 24px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        /* –í—ã–±–æ—Ä —Ç–µ–º—ã */
        .topics-scroller {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
        }

        .topic-chip {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 12px 20px;
            border-radius: 100px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .topic-chip.selected {
            background: #fff;
            color: #000;
            box-shadow: 0 0 15px rgba(255,255,255,0.3);
            border-color: #fff;
        }

        .slider-wrapper { margin: 30px 0; text-align: center; }
        .count-val { font-size: 48px; font-weight: 800; letter-spacing: -2px; line-height: 1; }
        
        input[type=range] {
            width: 100%; height: 4px; background: rgba(255,255,255,0.1);
            border-radius: 2px; appearance: none; margin-top: 20px;
        }
        input[type=range]::-webkit-slider-thumb {
            appearance: none; width: 24px; height: 24px; background: #fff;
            border-radius: 50%; cursor: pointer; box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        /* –ò–ì–†–û–í–ê–Ø –ó–û–ù–ê */
        .game-card-area {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            perspective: 1000px;
        }

        .secret-card {
            width: 100%;
            height: 340px;
            position: relative;
            border-radius: 24px;
            background: rgba(20, 20, 20, 0.6);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            transition: transform 0.2s;
        }
        .secret-card:active { transform: scale(0.98); }

        /* –®–¢–û–†–ö–ê */
        .curtain {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #1a1a1a; 
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            transition: opacity 0.4s cubic-bezier(0.25, 1, 0.5, 1);
            opacity: 1;
        }
        
        .curtain.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .role-text { font-size: 32px; font-weight: 800; text-align: center; z-index: 1; margin: 0 10px; }
        .role-sub { font-size: 14px; color: var(--text-muted); margin-top: 10px; z-index: 1; }
        .spy-text { color: var(--danger); text-shadow: 0 0 20px rgba(255, 82, 82, 0.4); }

        .btn-main {
            background: #fff; color: #000; border: none; padding: 20px;
            border-radius: 18px; font-size: 16px; font-weight: 700; width: 100%;
            cursor: pointer; margin-bottom: 20px; transition: transform 0.1s;
        }
        .btn-main:active { transform: scale(0.97); }

        .timer-box {
            font-size: 64px; font-weight: 800; text-align: center; margin: 40px 0;
            font-variant-numeric: tabular-nums; letter-spacing: -3px;
        }
    </style>
</head>
<body>

    <div class="app-overlay"></div>

    <div id="screen-setup" class="screen active-screen">
        <div style="margin-top: 20px;">
            <h1>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
            <p class="hint">–°–æ–∑–¥–∞–π—Ç–µ –∏–≥—Ä—É</p>
        </div>

        <div class="glass-card">
            <h2 style="text-align: center;">–ò–≥—Ä–æ–∫–∏</h2>
            <div class="slider-wrapper">
                <div class="count-val" id="countVal">4</div>
                <input type="range" id="playerCount" min="3" max="15" value="4" oninput="updateUI()">
            </div>
        </div>

        <div>
            <h2>–¢–µ–º–∞</h2>
            <div class="topics-scroller" id="topicsContainer"></div>
        </div>

        <button class="btn-main" onclick="startGame()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
    </div>

    <div id="screen-game" class="screen">
        <div style="text-align: center; margin-top: 20px;">
            <h2 id="playerCounter">–ò–≥—Ä–æ–∫ 1</h2>
            <p class="hint" id="statusHint">–ü–µ—Ä–µ–¥–∞–π —Ç–µ–ª–µ—Ñ–æ–Ω</p>
        </div>

        <div class="game-card-area">
            <div class="secret-card" onclick="revealCard()">
                
                <div class="curtain" id="curtain">
                    <div style="font-size: 40px; margin-bottom: 10px; opacity: 0.5;">üîí</div>
                    <div style="font-weight: 600; color: #aaa;">–ù–∞–∂–º–∏, —á—Ç–æ–±—ã<br>—É–≤–∏–¥–µ—Ç—å —Ä–æ–ª—å</div>
                </div>

                <div id="roleContent" style="width: 100%; text-align: center;">
                    <div id="roleWord" class="role-text">...</div>
                    <div id="roleHint" class="role-sub">...</div>
                </div>

            </div>
        </div>

        <button class="btn-main" id="actionBtn" onclick="nextPlayer()" style="opacity: 0; pointer-events: none; transition: opacity 0.2s;">
            –Ø –∑–∞–ø–æ–º–Ω–∏–ª, –¥–∞–ª–µ–µ
        </button>
    </div>

    <div id="screen-timer" class="screen">
        <div style="margin-top: 40px; text-align: center;">
            <h1>–û–±—Å—É–∂–¥–µ–Ω–∏–µ</h1>
            <p class="hint">–ù–∞–π–¥–∏—Ç–µ —à–ø–∏–æ–Ω–∞</p>
        </div>

        <div class="timer-box" id="timerDisplay">5:00</div>

        <div class="glass-card" style="text-align: center;">
            <p style="color: var(--text-muted); margin-bottom: 10px;">–¢–µ–º–∞ –±—ã–ª–∞:</p>
            <h2 style="color: #fff; font-size: 24px;" id="finalWord">...</h2>
        </div>

        <button class="btn-main" onclick="location.reload()">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
    </div>

    <script>
        const data = {
            "Clash Royale": ["–ë—Ä–µ–≤–Ω–æ", "–§–∞–µ—Ä–±–æ–ª", "–ó–∞–ø", "–°–∫–µ–ª–µ—Ç—ã", "–õ–µ–¥—è–Ω–æ–π –¥—É—Ö", "–†—ã—Ü–∞—Ä—å", "–í–∞–ª—å–∫–∏—Ä–∏—è", "–õ—É—á–Ω–∏—Ü—ã", "–ú—É—à–∫–µ—Ç—ë—Ä", "–•–æ–≥ –†–∞–π–¥–µ—Ä", "–®–∞—Ö—Ç—ë—Ä", "–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π –≥–∏–≥–∞–Ω—Ç", "–ì–æ–±–ª–∏–Ω—Å–∫–∞—è –±–æ—á–∫–∞", "–ú–µ–≥–∞ —Ä—ã—Ü–∞—Ä—å", "–ò–Ω—Ñ–µ—Ä–Ω–æ-–±–∞—à–Ω—è", "–¢–µ—Å–ª–∞", "–≠–ª–µ–∫—Ç—Ä–æ-–¥—Ä–∞–∫–æ–Ω", "–ö–æ–ª–¥—É–Ω", "–í–µ–¥—å–º–∞", "–ü—Ä–∏–Ω—Ü"],
            "Marvel": ["–ß–µ–ª–æ–≤–µ–∫-–ø–∞—É–∫", "–ñ–µ–ª–µ–∑–Ω—ã–π —á–µ–ª–æ–≤–µ–∫", "–ö–∞–ø–∏—Ç–∞–Ω –ê–º–µ—Ä–∏–∫–∞", "–¢–æ—Ä", "–•–∞–ª–∫", "–î–æ–∫—Ç–æ—Ä –°—Ç—Ä—ç–Ω–¥–∂", "–ß—ë—Ä–Ω–∞—è –≤–¥–æ–≤–∞", "–ß—ë—Ä–Ω–∞—è –ø–∞–Ω—Ç–µ—Ä–∞", "–ê–ª–∞—è –í–µ–¥—å–º–∞", "–õ–æ–∫–∏"],
            "–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ": ["MrBeast", "IShowSpeed", "Charlie Kirk", "Eminem", "Epstein", "–®–µ—Ñ", "–û–≥—É–∑–æ–∫", "–ê–∑–∏–º –ö–∞–Ω—ã–±–µ–∫–æ–≤"],
            "–£—á–∏—Ç–µ–ª—è": ["–ó–µ–ª–µ–Ω—ã–π", "–ö–æ–ª—è", "–≠–º—á–µ–∫", "–ö—É–±–∏–∫", "–ö–æ—Ä–æ–∑", "–ù—É—Ä–∞–ª—ã", "–¢—É–∞–ª–µ—Ç", "–ê–ª–∏–Ω–∫–∞", "–õ—É–∏–∑–∞", "–ß–∞–π–Ω–∞–≥—É–ª—å"]
        };

        let config = { players: 4, topic: "Clash Royale" };
        let game = { roles: [], current: 0, secret: "" };
        let isRevealed = false;
        let timerInt;

        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        window.onload = () => {
            const container = document.getElementById('topicsContainer');
            Object.keys(data).forEach(t => {
                const chip = document.createElement('div');
                chip.className = `topic-chip ${t === config.topic ? 'selected' : ''}`;
                chip.innerText = t;
                chip.onclick = () => {
                    config.topic = t;
                    document.querySelectorAll('.topic-chip').forEach(c => c.classList.remove('selected'));
                    chip.classList.add('selected');
                };
                container.appendChild(chip);
            });
        };

        function updateUI() {
            config.players = document.getElementById('playerCount').value;
            document.getElementById('countVal').innerText = config.players;
        }

        function startGame() {
            const list = data[config.topic];
            game.secret = list[Math.floor(Math.random() * list.length)];
            
            game.roles = Array(parseInt(config.players)).fill(game.secret);
            const spyIdx = Math.floor(Math.random() * game.roles.length);
            game.roles[spyIdx] = "–®–ü–ò–û–ù";

            game.current = 0;
            showScreen('screen-game');
            
            // –°—Ä–∞–∑—É —Ä–µ–Ω–¥–µ—Ä–∏–º –ø–µ—Ä–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞
            renderCardContent();
            // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —à—Ç–æ—Ä–∫–∞ –∑–∞–∫—Ä—ã—Ç–∞ –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≥–æ—Ç–æ–≤
            resetCardState();
        }

        // –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –≤–Ω—É—Ç—Ä–∏ (–ø–æ–¥ —à—Ç–æ—Ä–∫–æ–π)
        function renderCardContent() {
            const role = game.roles[game.current];
            const wordEl = document.getElementById('roleWord');
            const hintEl = document.getElementById('roleHint');
            
            if (role === "–®–ü–ò–û–ù") {
                wordEl.innerText = role;
                wordEl.classList.add('spy-text');
                hintEl.innerText = "–¢—Å—Å... –ù–µ –≤—ã–¥–∞–≤–∞–π —Å–µ–±—è";
            } else {
                wordEl.innerText = role;
                wordEl.classList.remove('spy-text');
                hintEl.innerText = `–¢–µ–º–∞: ${config.topic}`;
            }
            
            document.getElementById('playerCounter').innerText = `–ò–≥—Ä–æ–∫ ${game.current + 1}`;
        }

        // –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É –≤ –∑–∞–∫—Ä—ã—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        function resetCardState() {
            isRevealed = false;
            document.getElementById('curtain').classList.remove('hidden'); // –ó–ê–ö–†–´–í–ê–ï–ú
            document.getElementById('actionBtn').style.opacity = '0';
            document.getElementById('actionBtn').style.pointerEvents = 'none';
            document.getElementById('statusHint').innerText = "–ü–µ—Ä–µ–¥–∞–π —Ç–µ–ª–µ—Ñ–æ–Ω —ç—Ç–æ–º—É –∏–≥—Ä–æ–∫—É";
        }

        function revealCard() {
            if (isRevealed) return;
            isRevealed = true;
            document.getElementById('curtain').classList.add('hidden'); // –û–¢–ö–†–´–í–ê–ï–ú
            document.getElementById('statusHint').innerText = "–ó–∞–ø–æ–º–Ω–∏ —Å–≤–æ—é —Ä–æ–ª—å";
            
            setTimeout(() => {
                const btn = document.getElementById('actionBtn');
                btn.style.opacity = '1';
                btn.style.pointerEvents = 'auto';
            }, 500);
        }

        // –°–ê–ú–û–ï –í–ê–ñ–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ó–î–ï–°–¨
        function nextPlayer() {
            // 1. –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –Ω–µ–ª—å–∑—è –±—ã–ª–æ –Ω–∞–∂–∞—Ç—å –¥–≤–∞–∂–¥—ã
            const btn = document.getElementById('actionBtn');
            btn.style.opacity = '0';
            btn.style.pointerEvents = 'none';

            // 2. –°–Ω–∞—á–∞–ª–∞ –∑–∞–∫—Ä—ã–≤–∞–µ–º —à—Ç–æ—Ä–∫—É!
            document.getElementById('curtain').classList.remove('hidden');
            document.getElementById('statusHint').innerText = "–ü–µ—Ä–µ–¥–∞—é —Ö–æ–¥...";

            // 3. –ñ–¥–µ–º 400–º—Å (–ø–æ–∫–∞ —à—Ç–æ—Ä–∫–∞ –∑–∞–∫—Ä–æ–µ—Ç—Å—è), –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º –º–µ–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
            setTimeout(() => {
                game.current++;
                if (game.current >= game.roles.length) {
                    startTimer();
                    showScreen('screen-timer');
                } else {
                    renderCardContent(); // –ú–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –ø–æ–¥ –∑–∞–∫—Ä—ã—Ç–æ–π —à—Ç–æ—Ä–∫–æ–π
                    resetCardState();    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                }
            }, 400);
        }

        function startTimer() {
            document.getElementById('finalWord').innerText = `${game.secret} (${config.topic})`;
            let time = 300;
            const display = document.getElementById('timerDisplay');
            
            timerInt = setInterval(() => {
                const m = Math.floor(time / 60);
                const s = time % 60;
                display.innerText = `${m}:${s < 10 ? '0'+s : s}`;
                time--;
                if (time < 0) clearInterval(timerInt);
            }, 1000);
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active-screen'));
            document.getElementById(id).classList.add('active-screen');
        }
    </script>
</body>
</html>
