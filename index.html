<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–®–ø–∏–æ–Ω Premium</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #020610; /* –û—á–µ–Ω—å —Ç–µ–º–Ω—ã–π —Å–∏–Ω–∏–π */
            --bg-light: #0f1c35; /* –ß—É—Ç—å —Å–≤–µ—Ç–ª–µ–µ */
            --accent: #2b6eff; /* –Ø—Ä–∫–∏–π —Å–∏–Ω–∏–π –¥–ª—è –∞–∫—Ü–µ–Ω—Ç–æ–≤ */
            --accent-glow: rgba(43, 110, 255, 0.4);
            --text-main: #ffffff;
            --text-sec: #8b9bb4;
            --glass: rgba(255, 255, 255, 0.05);
            --border: rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0;
            padding: 20px;
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-light) 100%);
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-5px); } 100% { transform: translateY(0px); } }
        
        .screen {
            width: 100%;
            max-width: 400px;
            display: none; /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            flex-direction: column;
            align-items: center;
            animation: fadeIn 0.5s ease-out forwards;
        }

        .active-screen { display: flex; }

        h1 { font-size: 28px; font-weight: 800; margin-bottom: 5px; text-shadow: 0 0 20px var(--accent-glow); }
        h2 { font-size: 22px; margin: 10px 0; font-weight: 600; }
        p { color: var(--text-sec); font-size: 14px; text-align: center; margin-bottom: 20px; }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã */
        .glass-panel {
            background: var(--glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 20px;
            width: 100%;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        /* –í—ã–±–æ—Ä —Ç–µ–º—ã */
        .topics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            width: 100%;
            margin-bottom: 20px;
        }

        .topic-btn {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border);
            color: var(--text-sec);
            padding: 15px;
            border-radius: 15px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .topic-btn.selected {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            box-shadow: 0 0 20px var(--accent-glow);
            transform: scale(1.02);
        }

        /* –°–ª–∞–π–¥–µ—Ä –∏–≥—Ä–æ–∫–æ–≤ */
        .slider-container {
            width: 100%;
            margin: 20px 0;
            text-align: center;
        }
        
        input[type=range] {
            width: 100%;
            -webkit-appearance: none;
            background: transparent;
        }
        
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            background: var(--border);
            border-radius: 3px;
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 24px;
            width: 24px;
            border-radius: 50%;
            background: var(--accent);
            margin-top: -9px;
            box-shadow: 0 0 15px var(--accent-glow);
            border: 2px solid #fff;
        }

        .count-display {
            font-size: 42px;
            font-weight: 800;
            color: var(--accent);
            margin-bottom: 10px;
        }

        /* –ò–≥—Ä–æ–≤–æ–π –ø—Ä–æ—Ü–µ—Å—Å */
        .card-reveal-area {
            height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .secret-word {
            font-size: 28px;
            font-weight: 800;
            text-align: center;
            color: white;
            z-index: 2;
        }
        
        .spy-alert { color: #ff4757; text-shadow: 0 0 20px rgba(255, 71, 87, 0.5); font-size: 32px; }

        .blur-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(15, 28, 53, 0.95);
            backdrop-filter: blur(20px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            transition: opacity 0.4s ease;
            border-radius: 16px;
        }

        .blur-overlay.hidden { opacity: 0; pointer-events: none; }

        .tap-icon {
            font-size: 40px;
            margin-bottom: 15px;
            animation: float 2s infinite ease-in-out;
        }

        /* –ö–Ω–æ–ø–∫–∞ */
        .main-btn {
            background: var(--accent);
            color: white;
            border: none;
            width: 100%;
            padding: 18px;
            font-size: 18px;
            font-weight: 700;
            border-radius: 16px;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            transition: transform 0.1s;
        }
        .main-btn:active { transform: scale(0.96); }

        /* –¢–∞–π–º–µ—Ä */
        .timer-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: 4px solid var(--border);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 48px;
            font-weight: 800;
            margin: 30px auto;
            position: relative;
        }
        
        .timer-circle::after {
            content: '';
            position: absolute;
            top: -4px; left: -4px; right: -4px; bottom: -4px;
            border-radius: 50%;
            border: 4px solid var(--accent);
            border-top-color: transparent;
            animation: spin 4s linear infinite; /* –ü—Ä–æ—Å—Ç–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –≤–∏–¥–∞ */
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <div id="screen-setup" class="screen active-screen">
        <h1>–®–ü–ò–û–ù</h1>
        <p>–ù–∞—Å—Ç—Ä–æ–π –∏–≥—Ä—É –ø–æ–¥ —Å–≤–æ—é –∫–æ–º–ø–∞–Ω–∏—é</p>

        <div class="glass-panel">
            <p style="margin: 0 0 10px 0;">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤</p>
            <div class="count-display"><span id="countVal">4</span></div>
            <div class="slider-container">
                <input type="range" id="playerCount" min="3" max="15" value="4" oninput="updateCountDisplay()">
            </div>
        </div>

        <p style="margin-bottom: 10px;">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É:</p>
        <div class="topics-grid" id="topicsContainer">
            </div>

        <button class="main-btn" onclick="startGame()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
    </div>

    <div id="screen-game" class="screen">
        <h2 id="playerTitle">–ò–≥—Ä–æ–∫ 1</h2>
        <p>–ü–µ—Ä–µ–¥–∞–π—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω —ç—Ç–æ–º—É –∏–≥—Ä–æ–∫—É</p>

        <div class="glass-panel card-reveal-area" id="cardArea" onclick="toggleReveal()">
            
            <div class="blur-overlay" id="curtain">
                <div class="tap-icon">üëÜ</div>
                <div style="font-weight: 600;">–ù–∞–∂–º–∏, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å</div>
            </div>

            <div id="secretContent">
                <p style="margin-bottom: 5px; opacity: 0.6;">–¢–≤–æ—è —Ä–æ–ª—å:</p>
                <div id="roleText" class="secret-word">...</div>
                <div id="topicHint" style="margin-top: 15px; font-size: 12px; color: var(--accent);">–¢–µ–º–∞: ...</div>
            </div>

        </div>

        <p id="instruction" style="opacity: 0.5;">–ù–∞–∂–º–∏ –Ω–∞ –∫–∞—Ä—Ç—É, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å —Ä–æ–ª—å</p>
        
        <button class="main-btn" id="nextBtn" onclick="nextPlayer()" style="display: none; background: #222;">
            –°–∫—Ä—ã—Ç—å –∏ –ø–µ—Ä–µ–¥–∞—Ç—å
        </button>
    </div>

    <div id="screen-timer" class="screen">
        <h1>–í—Ä–µ–º—è –ø–æ—à–ª–æ!</h1>
        <p>–ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –∏ –∏—â–∏—Ç–µ —à–ø–∏–æ–Ω–∞</p>

        <div class="timer-circle" id="timerDisplay">5:00</div>

        <div class="glass-panel">
            <p>–õ–æ–∫–∞—Ü–∏—è / –¢–µ–º–∞ –±—ã–ª–∞:</p>
            <h2 id="finalLocation" style="color: var(--accent);">...</h2>
        </div>

        <button class="main-btn" onclick="resetGame()">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
    </div>

    <script>
        // --- –î–ê–ù–ù–´–ï (–¢–µ–º—ã) ---
        const gameData = {
            "Clash Royale": [
                "–ë—Ä–µ–≤–Ω–æ", "–§–∞–µ—Ä–±–æ–ª", "–ó–∞–ø", "–°–∫–µ–ª–µ—Ç—ã", "–õ–µ–¥—è–Ω–æ–π –¥—É—Ö", "–†—ã—Ü–∞—Ä—å", 
                "–í–∞–ª—å–∫–∏—Ä–∏—è", "–õ—É—á–Ω–∏—Ü—ã", "–ú—É—à–∫–µ—Ç—ë—Ä", "–•–æ–≥ –†–∞–π–¥–µ—Ä", "–®–∞—Ö—Ç—ë—Ä", 
                "–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π –≥–∏–≥–∞–Ω—Ç", "–ì–æ–±–ª–∏–Ω—Å–∫–∞—è –±–æ—á–∫–∞", "–ú–µ–≥–∞ —Ä—ã—Ü–∞—Ä—å", 
                "–ò–Ω—Ñ–µ—Ä–Ω–æ-–±–∞—à–Ω—è", "–¢–µ—Å–ª–∞", "–≠–ª–µ–∫—Ç—Ä–æ-–¥—Ä–∞–∫–æ–Ω", "–ö–æ–ª–¥—É–Ω", "–í–µ–¥—å–º–∞", "–ü—Ä–∏–Ω—Ü"
            ],
            "Marvel": [
                "–ß–µ–ª–æ–≤–µ–∫-–ø–∞—É–∫", "–ñ–µ–ª–µ–∑–Ω—ã–π —á–µ–ª–æ–≤–µ–∫", "–ö–∞–ø–∏—Ç–∞–Ω –ê–º–µ—Ä–∏–∫–∞", "–¢–æ—Ä", "–•–∞–ª–∫",
                "–î–æ–∫—Ç–æ—Ä –°—Ç—Ä—ç–Ω–¥–∂", "–ß—ë—Ä–Ω–∞—è –≤–¥–æ–≤–∞", "–ß—ë—Ä–Ω–∞—è –ø–∞–Ω—Ç–µ—Ä–∞", "–ê–ª–∞—è –í–µ–¥—å–º–∞", "–õ–æ–∫–∏"
            ],
            "–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ": [
                "MrBeast", "IShowSpeed", "Charlie Kirk", "Eminem", "Epstein", 
                "–®–µ—Ñ", "–û–≥—É–∑–æ–∫", "–ê–∑–∏–º –ö–∞–Ω—ã–±–µ–∫–æ–≤"
            ],
            "–£—á–∏—Ç–µ–ª—è": [
                "–ó–µ–ª–µ–Ω—ã–π", "–ö–æ–ª—è", "–≠–º—á–µ–∫", "–ö—É–±–∏–∫", "–ö–æ—Ä–æ–∑", "–ù—É—Ä–∞–ª—ã", 
                "–¢—É–∞–ª–µ—Ç", "–ê–ª–∏–Ω–∫–∞", "–õ—É–∏–∑–∞", "–ß–∞–π–Ω–∞–≥—É–ª—å"
            ]
        };

        // --- –ü–ï–†–ï–ú–ï–ù–ù–´–ï ---
        let selectedTopic = "Clash Royale";
        let playerCount = 4;
        let players = []; // –ú–∞—Å—Å–∏–≤ —Ä–æ–ª–µ–π
        let currentIndex = 0;
        let currentSecret = ""; 
        let currentTopicName = "";
        let isRevealed = false;
        let timerInterval;

        const tg = window.Telegram.WebApp;
        tg.expand();

        // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
        function init() {
            const container = document.getElementById('topicsContainer');
            const topics = Object.keys(gameData);
            
            topics.forEach(topic => {
                const btn = document.createElement('div');
                btn.className = `topic-btn ${topic === selectedTopic ? 'selected' : ''}`;
                btn.innerText = topic;
                btn.onclick = () => selectTopic(topic, btn);
                container.appendChild(btn);
            });
        }

        function updateCountDisplay() {
            playerCount = document.getElementById('playerCount').value;
            document.getElementById('countVal').innerText = playerCount;
        }

        function selectTopic(topic, btnElement) {
            selectedTopic = topic;
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª
            document.querySelectorAll('.topic-btn').forEach(b => b.classList.remove('selected'));
            btnElement.classList.add('selected');
        }

        // --- –õ–û–ì–ò–ö–ê –ò–ì–†–´ ---
        function startGame() {
            // 1. –í—ã–±–∏—Ä–∞–µ–º —Å–ª–æ–≤–æ
            const wordList = gameData[selectedTopic];
            currentSecret = wordList[Math.floor(Math.random() * wordList.length)];
            currentTopicName = selectedTopic;

            // 2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–æ–ª–∏
            players = Array(parseInt(playerCount)).fill(currentSecret);
            const spyCount = 1; // –ú–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –≤ –±—É–¥—É—â–µ–º
            
            // –°—Ç–∞–≤–∏–º —à–ø–∏–æ–Ω–∞
            let spyIndex = Math.floor(Math.random() * parseInt(playerCount));
            players[spyIndex] = "–®–ü–ò–û–ù";

            // 3. –°–±—Ä–æ—Å UI
            currentIndex = 0;
            isRevealed = false;
            switchScreen('screen-game');
            updateCardUI();
        }

        function updateCardUI() {
            document.getElementById('playerTitle').innerText = `–ò–≥—Ä–æ–∫ ${currentIndex + 1}`;
            document.getElementById('curtain').classList.remove('hidden'); // –ó–∞–∫—Ä—ã–≤–∞–µ–º —à—Ç–æ—Ä–∫—É
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('instruction').innerText = "–ù–∞–∂–º–∏ –Ω–∞ –∫–∞—Ä—Ç—É, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å —Ä–æ–ª—å";
            isRevealed = false;

            // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞ (–Ω–æ –æ–Ω —Å–∫—Ä—ã—Ç —à—Ç–æ—Ä–∫–æ–π)
            const roleEl = document.getElementById('roleText');
            const hintEl = document.getElementById('topicHint');
            const role = players[currentIndex];

            if (role === "–®–ü–ò–û–ù") {
                roleEl.innerText = "–¢–´ –®–ü–ò–û–ù üïµÔ∏è";
                roleEl.classList.add('spy-alert');
                hintEl.innerText = "–¢–≤–æ—è –∑–∞–¥–∞—á–∞: –Ω–µ —Å–ø–∞–ª–∏—Ç—å—Å—è –∏ —É–≥–∞–¥–∞—Ç—å —Ç–µ–º—É.";
            } else {
                roleEl.innerText = role;
                roleEl.classList.remove('spy-alert');
                hintEl.innerText = `–¢–µ–º–∞: ${currentTopicName}`;
            }
        }

        function toggleReveal() {
            if (isRevealed) return; // –£–∂–µ –æ—Ç–∫—Ä—ã—Ç–æ

            // –û—Ç–∫—Ä—ã–≤–∞–µ–º
            document.getElementById('curtain').classList.add('hidden');
            document.getElementById('nextBtn').style.display = 'block';
            document.getElementById('instruction').innerText = "–ó–∞–ø–æ–º–Ω–∏ —Ä–æ–ª—å –∏ –Ω–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –≤–Ω–∏–∑—É";
            isRevealed = true;
        }

        function nextPlayer() {
            currentIndex++;
            if (currentIndex >= players.length) {
                // –í—Å–µ –ø–æ—Å–º–æ—Ç—Ä–µ–ª–∏
                startTimer();
                switchScreen('screen-timer');
            } else {
                // –°–ª–µ–¥—É—é—â–∏–π
                updateCardUI();
            }
        }

        // --- –¢–ê–ô–ú–ï–† ---
        function startTimer() {
            document.getElementById('finalLocation').innerText = currentSecret;
            let time = 300; // 5 –º–∏–Ω—É—Ç
            const display = document.getElementById('timerDisplay');
            
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                let m = Math.floor(time / 60);
                let s = time % 60;
                display.innerText = `${m}:${s < 10 ? '0'+s : s}`;
                time--;
                if (time < 0) clearInterval(timerInterval);
            }, 1000);
        }

        function resetGame() {
            clearInterval(timerInterval);
            switchScreen('screen-setup');
        }

        // --- –£–¢–ò–õ–ò–¢–´ ---
        function switchScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active-screen'));
            document.getElementById(id).classList.add('active-screen');
        }

        // –ó–∞–ø—É—Å–∫
        init();

    </script>
</body>
</html>
